// Module included in the following assemblies:
//
// * authentication/identity_providers/configuring-github-identity-provider.adoc

[id='identity-provider-configuring-github-{context}']
= Configuring GitHub

You might need to take more steps to register GitHub as your identity provider.

.Prerequisites

* Register an application on GitHub or GitHub Enterprise to obtain a
Client ID and Client Secret.

.Procedure

. If you have:
- Already installed {product-title}, then copy the
*_/etc/origin/master/master-config.yaml_* file into a new directory, for example:
+
----
$ cd /etc/origin/master
$ mkdir githubconfig; cp master-config.yaml githubconfig
----
- Not yet installed {product-title}, then start the {product-title} API server,
specifying the hostname of the (future) {product-title} master and a directory
to store the configuration file created by the start command:
+
----
$ openshift start master --public-master=<apiserver> --write-config=<directory>
----
+
For example:
+
----
$ openshift start master --public-master=https://myapiserver.com:8443 --write-config=githubconfig
----
+
[NOTE]
====
If you are installing with Ansible, then you must add the
`identityProvider` configuration to the Ansible playbook.
If you use the following steps to modify your configuration manually after installing with Ansible, then you will lose any modifications whenever you re-run the install tool or upgrade.
====
+
[NOTE]
====
Using `openshift start master` on its own would auto-detect host names, but
GitHub must be able to redirect to the exact host name that you specified when
registering the application. For this reason, you cannot auto-detect the ID
because it might redirect to the wrong address. Instead, you must specify the
hostname that web browsers use to interact with your {product-title} cluster.
====
. Edit the new *_master-config.yaml_* file's `identityProviders` stanza, and copy the example `GitHubIdentityProvider` configuration
and paste it to replace the existing stanza:

. Make the following modifications to the `identityProviders` stanza:
.. Change the provider `name` to match the callback URL you configured on
GitHub.
+
For example, if you defined the callback URL as
`https://myapiserver.com:8443/oauth2callback/github/` then the `name` must be
`github`.
.. Change `clientID` to the Client ID from GitHub that you registered previously.
.. Change `clientSecret` to the Client Secret from GitHub that you
registered previously.
.. Change `organizations` or `teams` to include a list of one or more GitHub
organizations or teams to which a user must have membership in order to authenticate. If
specified, only GitHub users that are members of at least one of the listed
organizations or teams will be allowed to log in. If this is not specified, then any
person with a valid GitHub account can log in.
. Save your changes and close the file.
. Start the {product-title} API server, specifying the configuration file you just
modified:
+
----
$ openshift start master --config=<path/to/modified/config>/master-config.yaml
----

Once configured, any user logging in to the {product-title} web console will be
prompted to log in using their GitHub credentials. On their first login, the
user must click *authorize application* to permit GitHub to use their user name,
password, and organization membership with {product-title}. The user is then
redirected back to the web console.
