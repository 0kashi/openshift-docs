// Module included in the following assemblies:
//
// * logging/efk-logging-fluentd.adoc

[id='efk-logging-fluentd-connections-{context}']
= Reducing the number of connections from Fluentd to the API server

[IMPORTANT]
====
`mux` is a Technology Preview feature only.
ifdef::openshift-enterprise[]
Technology Preview features are not supported with Red Hat production service
level agreements (SLAs), might not be functionally complete, and Red Hat does
not recommend to use them for production. These features provide early access to
upcoming product features, enabling customers to test functionality and provide
feedback during the development process.

For more information on Red Hat Technology Preview features support scope, see
https://access.redhat.com/support/offerings/techpreview/.
endif::[]
====

`mux` is a Secure Forward listener service.

[cols="3,7",options="header"]
|===
|Parameter
|Description

| `openshift_logging_use_mux`
|The default is set to `False`. If set to `True`,
a service called `mux` is deployed. This service acts as a Fluentd
`secure_forward` aggregator for the node agent Fluentd daemonsets running in the
cluster. Use `openshift_logging_use_mux` to reduce the number of connections to
the OpenShift API server, and configure each node in Fluentd to send raw logs to
`mux` and turn off the Kubernetes metadata plug-in. This requires the use of
`openshift_logging_mux_client_mode`.

|`openshift_logging_mux_client_mode`
|Values for `openshift_logging_mux_client_mode` are `minimal` and `maximal`, and
there is no default. `openshift_logging_mux_client_mode` causes the Fluentd node
agent to send logs to mux rather than directly to Elasticsearch. The value
`maximal` means that Fluentd does as much processing as possible at the node
before sending the records to `mux`. The `maximal` value is recommended for
using `mux`. The value `minimal` means that Fluentd does no processing at all,
and sends the raw logs to `mux` for processing. It is not recommended to use the
`minimal` value.

| `openshift_logging_mux_allow_external`
|The default is set to `False`. If set to `True`, the `mux` service is
deployed, and it is configured to allow Fluentd clients running outside of
the cluster to send logs using `secure_forward`. This allows OpenShift logging
to be used as a central logging service for clients other than OpenShift, or
other OpenShift clusters.

| `openshift_logging_mux_hostname`
|The default is `mux` plus `openshift_master_default_subdomain`. This is the
hostname `external_clients` will use to connect to `mux`, and is used in the
TLS server cert subject.

| `openshift_logging_mux_port`
|24284

| `openshift_logging_mux_cpu_limit`
|500M

| `openshift_logging_mux_memory_limit`
|1Gi

| `openshift_logging_mux_default_namespaces`
|The default is `mux-undefined`. The first value in the list is the namespace to
use for undefined projects, followed by any additional namespaces to create by
default. Usually, you do not need to set this value.

| `openshift_logging_mux_namespaces`
|The default value is empty, allowing for additional namespaces to create for
external `mux` clients to associate with their logs. You will need to set this
value.
|===
