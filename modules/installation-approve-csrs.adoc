// Module included in the following assemblies:
//
// * installing/installing_aws_user_infra/installing-aws-user-infra.adoc
// * installing/installing_bare_metal/installing-bare-metal.adoc
// * installing/installing_vsphere/installing-vsphere.adoc
// * machine_management/adding-rhel-compute.adoc
// * machine_management/more-rhel-compute.adoc

[id="installation-approve-csrs_{context}"]
= Approving the CSRs for your machines

When you add machines to a cluster, you must approve two pending certificates
signing request (CSRs) for each machine that you added.

.Prerequisites

* You added machines to your cluster.

.Procedure

. Review the pending certificate signing requests (CSRs) and ensure that the
you see a client and server request with `Pending` status for each machine that
you added to the cluster:
+
----
$ oc get csr

NAME        AGE     REQUESTOR                                                                   CONDITION
csr-8b2br   15m     system:serviceaccount:openshift-machine-config-operator:node-bootstrapper   Pending <1>
csr-8vnps   15m     system:serviceaccount:openshift-machine-config-operator:node-bootstrapper   Pending
csr-bfd72   5m26s   system:node:ip-10-0-50-126.us-east-2.compute.internal                       Pending <2>
csr-c57lv   5m26s   system:node:ip-10-0-95-157.us-east-2.compute.internal                       Pending
----
<1> A client request CSR.
<2> A server request CSR.
+
In this example, two machines are joining the cluster.

. After all of the pending CSRs for the machines you added are in `Pending`
status, approve the CSRs for your cluster machines:
+
[NOTE]
====
Because the CSRs rotate automatically, approve your CSRs within half an hour
of adding the machines to the cluster. After you approve the initial CSRs,
the subsequent CSRs are automatically approved by the cluster
`kube-controller-manger`.
====

** To approve them individually, run the following command for each valid
CSR:
+
----
$ oc adm certificate approve <csr_name> <1>
----
<1> `<csr_name>` is the name of a CSR from the list of current CSRs.

** If all the CSRs are valid, approve them all by running the following
command:
+
----
$ oc get csr -ojson | jq -r '.items[] | select(.status == {} ) | .metadata.name' | xargs oc adm certificate approve
----