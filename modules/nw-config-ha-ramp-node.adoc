// Module included in the following assemblies:
//
// * assembly/networking/routing-from-edge-load-balancer.adoc

[id="nw-config-ha-ramp-node-{context}"]
= Configuring a highly available ramp node

You can use {product-title}'s `ipfailover` feature, which uses `keepalived`
internally, to make the ramp node highly available from `F5 BIG-IP®`'s point of
view.

.Procedure

. Bring up two nodes, for example called `ramp-node-1` and
`ramp-node-2`, on the same L2 subnet.

. Choose some unassigned IP address from within the same subnet to use for
your virtual IP, or _VIP_. This will be set as the `RAMP_IP` variable with
which you will configure your tunnel on `F5 BIG-IP®`.
+
For example, suppose you are using the `10.20.30.0/24` subnet for your ramp
nodes, and you have assigned `10.20.30.2` to `ramp-node-1` and `10.20.30.3` to
`ramp-node-2`. For your VIP, choose some unassigned address from the same
`10.20.30.0/24` subnet, for example `10.20.30.4`. Then, to configure
`ipfailover`, mark both nodes with a label, such as `f5rampnode`:
+
----
$ oc label node ramp-node-1 f5rampnode=true
$ oc label node ramp-node-2 f5rampnode=true
----

. Create a service account and add it to the
`privileged` SCC. First, create the `f5ipfailover` service account:
+
----
$ oc create serviceaccount f5ipfailover -n default
----

. Add the `f5ipfailover` service to the `privileged` SCC.
To add the `f5ipfailover` in the `default` namespace to the `privileged` SCC, run:
+
----
$ oc adm policy add-scc-to-user privileged system:serviceaccount:default:f5ipfailover
----

. Configure `ipfailover` using your chosen VIP (the `RAMP_IP` variable)
and the `f5ipfailover` service account, assigning the VIP to your two nodes using
the `f5rampnode` label you set earlier:
+
----
# RAMP_IP=10.20.30.4
# IFNAME=eth0 <1>
# oc adm ipfailover <name-tag> \
    --virtual-ips=$RAMP_IP \
    --interface=$IFNAME \
    --watch-port=0 \
    --replicas=2 \
    --service-account=f5ipfailover  \
    --selector='f5rampnode=true'
----
<1> The interface where `RAMP_IP` should be configured.
+
With the above setup, the VIP (the `RAMP_IP` variable) is automatically
re-assigned when the ramp node host that currently has it assigned fails.
