// Module included in the following assemblies:
//
// * logging/efk-logging-deploy.adoc

[id='efk-logging-deploy-playbook_{context}']
= Running the Ansible playbook for deploying cluster logging

You can run an Ansible playbook to deploy cluster logging in {product-title} 

The playbook deploys all resources needed to support the stack, such as
Secrets, ServiceAccounts, and DeploymentConfigs. 

.Procedure

. Run the playbook from the default OpenShift Ansible location
using the Ansible inventory file:
+
ifdef::openshift-origin[]
----
$ ansible-playbook playbooks/openshift-logging/config.yml
----
endif::openshift-origin[]
ifdef::openshift-enterprise[]
----
$ cd /usr/share/ansible/openshift-ansible
$ ansible-playbook [-i </path/to/inventory>] \
    playbooks/openshift-logging/config.yml
----
endif::openshift-enterprise[]
+
The playbook waits to deploy the component pods until the stack is running. If the wait steps fail, the
deployment could still be successful; it may be retrieving the component images
from the registry which can take up to a few minutes. 

. Run the following command to verify the deployment
+
----
$ oc get pods -w
logging-curator-1541129400-l5h77           0/1       Running   0          11h  <1>
logging-es-data-master-ecu30lr4-1-deploy   0/1       Running   0          11h  <2>
logging-fluentd-2lgwn                      1/1       Running   0          11h  <3>
logging-fluentd-lmvms                      1/1       Running   0          11h
logging-fluentd-p9nd7                      1/1       Running   0          11h
logging-kibana-1-zk94k                     2/2       Running   0          11h  <4>
----
<1> The Curator pod. Only one pod is needed for Curator.
<2> The Elasticsearch pod on this host. 
<3> The Fliuentd pods. There is one pod for each node in the cluster.
<4> The Kibana pods.
+
When ready, the pods enter the *Running* status. 
+
[NOTE]
====
The logging-fluentd* pods are assigned a default priority class, `cluster-logging`, with a high priority that should prevent the pods from being descheduled.
If you upgraded {product-title}, Fluentd with the `scheduler.alpha.kubernetes.io/critical-pod` annotation are automatically converted  to the `cluster-logging` priority class.
====
=======

.Procedure

If the pods do not run successfully:

. Run the following command to view details about the status of the pods during deployment by retrieving
associated events:
+
----
oc describe pods/<pod_name>
----

. Check the default system logs:
+
----
$ oc logs -f <pod_name>
----
