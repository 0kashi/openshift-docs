// Module included in the following assemblies:
//
// * nodes/nodes-nodes-problem-detector.adoc

[id='nodes-nodes-problem-detector-about_{context}']
= Understanding the {product-title} node problem detector

The Node Problem Detector reads system logs and watches for specific entries and makes these problems visible to the control plane,
which you can view using {product-title} commands, such as `oc get node` and `oc get event`.
You could then take action to correct these problems as appropriate or capture the messages using a tool of your choice,
such as the {product-title} log monitoring.

Detected problems can be in one of the following categories:

* `NodeCondition`: A permanent problem that makes the node unavailable for pods.
The node condition will not be cleared until the host is rebooted.
* `Event`: A temporary problem that has limited impact on a node, but is informative.

The Node Problem Detector can detect:

* container runtime issues:
** unresponsive runtime daemons

* hardware issues:
** bad CPU
** bad memory
** bad disk

* kernel issues:
** kernel deadlock conditions
** corrupted file systems
** unresponsive runtime daemons

* infrastructure daemon issues:
** NTP service outages

[[nodes-nodes-problem-detector-about-example]]
== Example Node Problem Detector Output

The following examples show output from the Node Problem Detector watching for kernel deadlock node condition on a specific node. The command
uses `oc get node` to watch a specific node filtering for a `KernelDeadlock` entry in a log.

[source,bash]
----
# oc get node <node> -o yaml | grep -B5 KernelDeadlock
----

.Sample Node Problem Detector output with no issues
[source,bash]
----
message: kernel has no deadlock
reason: KernelHasNoDeadlock
status: false
type: KernelDeadLock
----

.Sample output for KernelDeadLock condition
[source,bash]
----
message: task docker:1234 blocked for more than 120 seconds
reason: DockerHung
status: true
type: KernelDeadLock
----

This example shows output from the Node Problem Detector watching for events on a node.
The following command uses `oc get event` against the *default* project watching for
events listed in the `kernel-monitor.json` section of the Node Problem Detector configuration map.

[source,bash]
----
# oc get event -n default --field-selector=source=kernel-monitor --watch
----

.Sample output showing events on nodes
[source,bash]
----
LAST SEEN                       FIRST SEEN                    COUNT NAME     KIND  SUBOBJECT TYPE    REASON      SOURCE                   MESSAGE
2018-06-27 09:08:27 -0400 EDT   2018-06-27 09:08:27 -0400 EDT 1     my-node1 node            Warning TaskHunk    kernel-monitor.my-node1  docker:1234 blocked for more than 300 seconds
2018-06-27 09:08:27 -0400 EDT   2018-06-27 09:08:27 -0400 EDT 3     my-node2 node            Warning KernelOops  kernel-monitor.my-node2  BUG: unable to handle kernel NULL pointer deference at nowhere
2018-06-27 09:08:27 -0400 EDT   2018-06-27 09:08:27 -0400 EDT 1     my-node1 node            Warning KernelOops  kernel-monitor.my-node2  divide error 0000 [#0] SMP
----

////
{product-title} supports the following problem daemons. Installation of these daemons is beyond the scope of this document.

|===
| Problem Daemon | NodeCondition | Description

| link:https://github.com/kubernetes/node-problem-detector/tree/master/pkg/systemlogmonitor[System Log Monitor]
| KernelDeadlock
| A system log that monitors kernel logs and reports problems according to predefined rules.

| link:https://github.com/abrt/abrt/wiki[AbrtAdaptor]
| None
| Monitors ABRT log messages. ABRT (Automatic Bug Report Tool) is a health monitoring daemon able
to catch kernel problems and application crashes on the host.

| link:https://github.com/kubernetes/node-problem-detector/blob/master/config/custom-plugin-monitor.json[CustomPluginMonitor]
| On-demand (based on user configuration)
| A custom plug-in monitor that checks various node problems.

|===
////

[NOTE]
====
The Node Problem Detector consumes resources. If you use the Node Problem Detector, make sure you have enough nodes to balance cluster performance.
====

If `openshift_node_problem_detector_install` was set to `true` in the *_/etc/ansible/hosts_* inventory file,
the installation creates a Node Problem Detector daemonset by default and creates a project for the detector, called `openshift-node-problem-detector`.


