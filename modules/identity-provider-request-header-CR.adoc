// Module included in the following assemblies:
//
// * authentication/identity_providers/configuring-request-header-identity-provider.adoc

[id="identity-provider-request-header-CR-{context}"]
= Sample request header CR

The following Custom Resource (CR) shows the parameters and 
acceptable values for a request header identity provider.

.Request header CR

[source,yaml]
----
apiVersion: config.openshift.io/v1
kind: OAuth
metadata:
  name: cluster
spec:
  identityProviders:
  - name: requestheaderidp <1>
    challenge: false <2>
    login: true <3>
    mappingMethod: claim <4>
    type: RequestHeader
    requestHeader:
      challengeURL: "https://www.example.com/challenging-proxy/oauth/authorize?${query}" <5>
      loginURL: "https://www.example.com/login-proxy/oauth/authorize?${query}" <6>
      ca: <7>
        name: ca-config-map
      clientCommonNames: <8>
      - my-auth-proxy
      headers: <9>
      - X-Remote-User
      - SSO-User
      emailHeaders: <10>
      - X-Remote-User-Email
      nameHeaders: <11>
      - X-Remote-User-Display-Name
      preferredUsernameHeaders: <12>
      - X-Remote-User-Login
----
<1> This provider name is prefixed to the user name in the request header to
form an identity name.
<2> `RequestHeaderIdentityProvider` can only respond to clients that request
`WWW-Authenticate` challenges by redirecting to a configured `challengeURL`. The
configured URL should respond with a `WWW-Authenticate` challenge.
<3> `RequestHeaderIdentityProvider` can only respond to clients requesting a
login flow by redirecting to a configured `loginURL`. The configured URL should
respond with a login flow.
<4> Controls how mappings are established between this provider's identities and user objects.
<5> Optional: URL to redirect unauthenticated `/oauth/authorize` requests to,
that will authenticate browser-based clients and then proxy their request to `\https://<master>/oauth/authorize`.
The URL that proxies to `\https://<master>/oauth/authorize` must end with `/authorize` (with no trailing slash),
and also proxy subpaths, in order for OAuth approval flows to work properly.
`${url}` is replaced with the current URL, escaped to be safe in a query parameter.
`${query}` is replaced with the current query string.
<6> Optional: URL to redirect unauthenticated `/oauth/authorize` requests to,
that will authenticate clients which expect `WWW-Authenticate` challenges, and then proxy them to `\https://<master>/oauth/authorize`.
`${url}` is replaced with the current URL, escaped to be safe in a query parameter.
`${query}` is replaced with the current query string.
<7> Reference to a {product-title} ConfigMap containing a PEM-encoded 
certificate bundle. Used as a trust anchor to validate the TLS 
certificates presented by the remote server. If this file is not
present or valid the identity provider is not honored.
<8> Optional: list of common names (`cn`). If set, a valid client certificate with
a Common Name (`cn`) in the specified list must be presented before the request headers
are checked for user names. If empty, any Common Name is allowed. Can only be used in combination
with `clientCA`.
<9> Header names to check, in order, for the user identity. The first header containing
a value is used as the identity. Required, case-insensitive.
<10> Header names to check, in order, for an email address. The first header containing
a value is used as the email address. Optional, case-insensitive.
<11> Header names to check, in order, for a display name. The first header containing
a value is used as the display name. Optional, case-insensitive.
<12> Header names to check, in order, for a preferred user name, if different than the immutable
identity determined from the headers specified in `headers`. The first header containing
a value is used as the preferred user name when provisioning. Optional, case-insensitive.
