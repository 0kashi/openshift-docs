// Module included in the following assemblies:
//
// * authentication/identity_providers/configuring-oidc-identity-provider.adoc

[id='identity-provider-oidc-CRD-{context}']
= Sample OpenID Connect CRDs

The following Custom Resource Definition (CRD)s shows the parameters and acceptable values for an
OpenID Connect identity provider.

If you need to specify a custom certificate bundle, extra scopes, extra authorization request
parameters, or a `userInfo` URL, use the full OpenID Connect CRD.

.Standard OpenID Connect CRD

[source,yaml]
----
oauthConfig:
  ...
  identityProviders:
  - name: my_openid_connect <1>
    challenge: true <2>
    login: true <3>
    mappingMethod: claim <4>
    provider:
      apiVersion: v1
      kind: OpenIDIdentityProvider
      clientID: ... <5>
      clientSecret: ... <6>
      claims:
        id: <7>
        - sub
        preferredUsername:
        - preferred_username
        name:
        - name
        email:
        - email
      urls:
        authorize: https://myidp.example.com/oauth2/authorize <8>
        token: https://myidp.example.com/oauth2/token <9>
----
<1> This provider name is prefixed to the value of the identity claim to form an
identity name. It is also used to build the redirect URL.
<2> When `true`, unauthenticated token requests from non-web clients (like
the CLI) are sent a `WWW-Authenticate` challenge header for this provider.
This requires the OpenID provider to support the
link:https://tools.ietf.org/html/rfc6749#section-1.3.3[Resource Owner Password Credentials] grant flow.
<3> When `true`, unauthenticated token requests from web clients (like the web
console) are redirected to the authorize URL to log in.
<4> Controls how mappings are established between this provider's identities and user objects.
<5> The client ID of a client registered with the OpenID provider. The client
must be allowed to redirect to `<master>/oauth2callback/<identityProviderName>`.
<6> The client secret. This value may also be provided in an
environment variable, external file, or encrypted file.
<7> List of claims to use as the identity. First non-empty claim is used. At
least one claim is required. If none of the listed claims have a value,
authentication fails. For example, this uses the value of the `sub` claim in the returned `id_token` as the user's identity.
<8> link:http://openid.net/specs/openid-connect-core-1_0.html#AuthorizationEndpoint[Authorization Endpoint]
described in the OpenID spec. Must use `https`.
<9> link:http://openid.net/specs/openid-connect-core-1_0.html#TokenEndpoint[Token Endpoint]
described in the OpenID spec. Must use `https`.

.Full OpenID Connect CRD

[source,yaml]
----
oauthConfig:
  ...
  identityProviders:
  - name: my_openid_connect
    challenge: false
    login: true
    mappingMethod: claim
    provider:
      apiVersion: v1
      kind: OpenIDIdentityProvider
      clientID: ...
      clientSecret: ...
      ca: my-openid-ca-bundle.crt <1>
      extraScopes: <2>
      - email
      - profile
      extraAuthorizeParameters: <3>
        include_granted_scopes: "true"
      claims:
        id: <4>
        - custom_id_claim
        - sub
        preferredUsername: <5>
        - preferred_username
        - email
        name: <6>
        - nickname
        - given_name
        - name
        email: <7>
        - custom_email_claim
        - email
      urls:
        authorize: https://myidp.example.com/oauth2/authorize
        token: https://myidp.example.com/oauth2/token
        userInfo: https://myidp.example.com/oauth2/userinfo <8>
----
<1> Certificate bundle to use to validate server certificates for the configured
URLs. If empty, system trusted roots are used.
<2> Optional list of scopes to request, in addition to the *openid* scope,
during the authorization token request.
<3> Optional map of extra parameters to add to the authorization token request.
<4> List of claims to use as the identity. First non-empty claim is used. At
least one claim is required. If none of the listed claims have a value,
authentication fails.
<5> List of claims to use as the preferred user name when provisioning a user
for this identity. First non-empty claim is used.
<6> List of claims to use as the display name. First non-empty claim is used.
<7> List of claims to use as the email address. First non-empty claim is used.
<8> link:http://openid.net/specs/openid-connect-core-1_0.html#UserInfo[UserInfo Endpoint] described in the OpenID spec. Must use `https`.
