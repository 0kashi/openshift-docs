// Module included in the following assemblies:
//
// * assembly/openshift_images
// * openshift_images/configuring_samples_operator.adoc


[id='samples-operator-configuration-{context}']
= Samples Operator configuration

The samples resource offers the following configuration fields:

* *ManagementState:*
** *Managed.* The operator updates the samples as the configuration dictates.
** *Unmanaged.* The operator ignores updates to the samples resource object and
any image streams or templates in the OpenShift namespace.
** *Removed.* The operator removes the set of `Managed` image streams and templates
in the OpenShift namespace. It ignores new samples created by the cluster
administator or any samples in the skipped lists. After the removals are
complete, the operator works like it is in the `Unmanaged` state and ignores
any watch events on the sample resources, image streams, or templates. It
operates on secrets to facilitate the  CENTOS to RHEL switch. There are some
caveats around concurrent create and removal.
+
[NOTE]
====
Neither deletion nor setting the `ManagementState` to `Removed` are completed
while image stream imports are still in progress. Once progress has completed,
either in success or in error, the deletion or removal commences.

Secret, image stream, and template watch events are ignored once deletion or
removal has started.
====
+
* *Samples Registry:* Overrides the registry from which images are imported.
+
[NOTE]
====
Creation or update of RHEL content does not commence if the secret for pull
access is not in place when using the default, registry.redhat.io, when
`SamplesRegistry` is not explicitly set.

Creation or update of RHEL content is not be gated if the `SamplesRegistry` has
been overridden.
====
+
* *Architecture:* Place holder to choose an architecture type. Currently only x86
is supported.
* *Skipped Image streams:* Image streams that are in the operator’s
inventory, but that the cluster administrator wants the operator to ignore or not manage.
* *Skipped Templates:* Templates that are in the operator’s inventory, but that
the cluster administrator wants the operator to ignore or not manage.

Secret, image stream, and template watch events can come in before the initial
samples resource object is created, the operator detects and re-queues the
event.

== Configuration restrictions

When supporting multiple architectures, the architecture list is not allowed to
be changed while in the `Managed` state.

In order to change the architectures values, a cluster administrator must:

* Mark the `ManagementState` as `Removed`, saving the change.
* In a subsequent change, edit the architecture and change the `ManagementState`
back to `Managed`.

The operator still processes secrets while in `Removed` state. You can create
the secret before switching to `Removed`, while in `Removed` before
switching to `Managed`, or after switching to `Managed` state (though
there are delays in creating the samples until the secret event is processed if
you create the secret after switching to `Managed`). This is done to
help facilitate the changing of the registry, where you choose to remove all the
samples before switching to insure a clean slate (removing before switching is
not required).

== Conditions

The samples resource maintains the following conditions in its status:

* *SamplesExists.* Indicates the samples are created in the OpenShift
namespace.
* *ImageChangesInProgress.*
** `True` when image streams are created/updated, but
not all of the tag spec generations and tag status generations match.
** `False` when all of the generations match, or unrecoverable errors occurred during
import, the last seen error is in the message field. The list of pending
image streams is in the reason field.
* *ImportCredentialsExist.* A 'samples-registry-credentials' secret is
copied into the OpenShift namespace.
* *ConfigurationValid.* `True` or `false` based on whether any of the restricted
    changes noted previously are submitted.
* *RemovePending.* Indicator that there is a`ManagementState` `Removed` setting
    pending, but are waiting for in progress image streams to complete.
* *ImportImageErrorsExist.* Indicator of which image streams had errors during
    the image import phase for one of their tags.
** `True` when an error has occurred. The list of image streams with an error is
in the reason field. The details of each error reported are in the
message field.
* *MigrationInProgress.* `True` when the Samples Operator detects that the
version is different than the Samples Operator version with which the current
samples set are installed.
