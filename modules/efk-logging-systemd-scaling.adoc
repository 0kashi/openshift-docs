// Module included in the following assemblies:
//
// * logging/efk-logging-deploy.adoc

[id='efk-logging-fluentd-scaling_{context}']
= Scaling up systemd-journald and rsyslog

As you scale up your project, the default logging environment might need some
adjustments. After updating to *systemd-219-22.el7.x86_64*, we added:

----
$IMUXSockRateLimitInterval 0
$IMJournalRatelimitInterval 0
----

to *_/etc/rsyslog.conf_* and:

----
# Disable rate limiting
RateLimitInterval=1s
RateLimitBurst=10000
Storage=volatile
Compress=no
MaxRetentionSec=30s
----

to *_/etc/systemd/journald.conf_*.

Now, restart the services.

----
$ systemctl restart systemd-journald.service
$ systemctl restart rsyslog.service
----

These settings account for the bursty nature of uploading in bulk.

After removing the rate limit, you may see increased CPU utilization on the
system logging daemons as it processes any messages that would have previously
been throttled.

Rsyslog is configured (see *ratelimit.interval*, *ratelimit.burst*) to
rate-limit entries read from the journal at 10,000 messages in 300 seconds. A
good rule of thumb is to ensure that the rsyslog rate-limits account for the
systemd-journald rate-limits.
