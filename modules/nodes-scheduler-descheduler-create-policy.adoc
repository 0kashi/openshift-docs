// Module included in the following assemblies:
//
// * nodes/nodes-scheduler-descheduler.adoc

[id='nodes-scheduler-descheduler-create-policy_{context}']
= Creating a policy for descheduling pods in {product-title}

You can configure the descheduler to remove pods from nodes that violate rules defined by _strategies_ in the Descheduler Operator Custom Resouce Definition (CRD).

.Procedure

To create the needed policy:

. Edit the Descheduler Operator CRD similar to the following:
+
.Sample descheduler policy file
[source,yaml]
----
apiVersion: descheduler.io/v1alpha1
kind: Descheduler
metadata:
  name: example-descheduler-1
spec:
  schedule: "*/1 * * * ?" <1>
  strategies:
    - name: "lownodeutilization" <2>
      params:
       - name: "cputhreshold" <3>
         value: "10"
       - name: "memorythreshold"
         value: "20"
       - name: "podsthreshold"
         value: "30"
       - name: "memorytargetthreshold" <4>
         value: "40"
       - name: "cputargetthreshold"
         value: "50"
       - name: "podstargetthreshold"
         value: "60"
       - name: "nodes"
         value: "3"  <5>
    - name: "duplicates" <6>
    - name: "interpodantiaffinity" <7>
    - name: "nodeaffinity" <8>
----
<1> Schedule for the job specified in link:https://en.wikipedia.org/wiki/Cron[cron format].
<2> Optionally configure the descheduler to move pods from underutilized nodes.
<3> Set the low-end thresholds for the `LowNodeUtilization` strategy. If the node is below all three values, the descheduler considers the node underutilized.
<4> Set the high-end thresholds for the `LowNodeUtilization` strategy. If the node is below these values and above the `threshold` values, the descheduler considers the node  properly utilized.
<5> Set the number of nodes that can be underutilized before the descheduler will evict pods from underutilized nodes.
<6> Specify `interpodantiaffinity` to have the descheduler remove duplicate ReplicaSet, Replication Controller, DeploymentConfig, or Job pods running on same node.
<7> Specify `duplicates` to have the descheduler remove pods violating node affinity from nodes.

. Create the descheduler object:
+
----
$ oc create -f <file-name>.yaml
----
+
The command creates a ConfigMap that triggers the Descheduler Operator to implement the changes.
+
[source,yaml]
----
apiVersion: "descheduler/v1alpha1"
kind: "DeschedulerPolicy"
strategies:
  "RemoveDuplicates":
     enabled: true
  "RemovePodsViolatingInterPodAntiAffinity":
     enabled: true
  "RemovePodsViolatingNodeAffinity":
     enabled: true
  "LowNodeUtilization":
     enabled: true
     params:
       nodeResourceUtilizationThresholds:
         thresholds:
           "cpu" : 10
           "memory": 20
           "pods": 30
         targetThresholds:
           "cpu" : 40
           "memory": 50
           "pods": 60
         numberOfNodes: 3
----
