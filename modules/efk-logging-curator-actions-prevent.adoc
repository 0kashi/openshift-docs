// Module included in the following assemblies:
//
// * logging/efk-logging-curator.adoc

[id='efk-logging-curator-actions-prevent_{context}']
= Preventing Curator from deleting internal indices

You can use the Curator *action file* to prevent Curator from deleting important internal
indices.

.Prerequisite

Set cluster logging to the unmanaged state.

.Procedure

To prevent Curator from deleting indices, edit the *actions file* to add an exclude rule. You must manually add all of the required patterns:

[source,yaml]
----
actions.yaml: |
actions:

    action: delete_indices <1>
    description: Do not delete
    filters:
    - exclude: true <2>
      kind: regex <3>
      filtertype: pattern <4>
      value: '^project\.myapp\..*$|^\.operations\..*$|^\.searchguard\..*$|^\.kibana$'
    - direction: older
      filtertype: age
      source: name
      timestring: '%Y.%m.%d'
      unit_count: 30
      unit: days
    options:
      continue_if_exception: false
      timeout_override: '300'
      ignore_empty_list: true
----
<1> Specify the `delete_indices` action.
<2> Specify `true` to prevent the indices from being deleted.
<3> Specify `.regex` to use regular expressions to match index names. User-defined regular expressions are checked for their validity and passed to Curator without further processing. 
<4> Specify pattern for `filertype`.
<5> Specify indices to retain using valid and properly escaped regular expression pattern enclosed by single quotation marks.

For more information on these parameters, see the link:https://www.elastic.co/guide/en/elasticsearch/client/curator/5.2/filters.html[Elastic Search curator documentation]. 
