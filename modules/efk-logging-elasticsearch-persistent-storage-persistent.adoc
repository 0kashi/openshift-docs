// Module included in the following assemblies:
//
// * logging/efk-logging-elasticsearch.adoc

[id='efk-logging-elasticsearch-persistent-storage-persistent_{context}']
= Using NFS as a persistent volume for Elasticsearch

You can deploy NFS as an automatically provisioned persistent volume or using a predefined NFS volume.

For more information, see _Sharing an NFS mount across two persistent volume claims_ to leverage shared storage for use by two separate containers.


*Using automatically provisioned NFS*

You can use NFS as a persistent volume where NFS is automatically provisioned.

.Procedure

. Add the following lines to the Ansible inventory file to create an NFS auto-provisioned storage class and dynamically provision the backing storage:
+
----
openshift_logging_es_pvc_storage_class_name=$nfsclass
openshift_logging_es_pvc_dynamic=true
----

. Use the following command to deploy the NFS volume using the logging playbook:
+
----
ansible-playbook /usr/share/ansible/openshift-ansible/playbooks/openshift-logging/config.yml
----

. Use the following steps to create a PVC:

.. Edit the Ansible inventory file to set the PVC size:
+
----
openshift_logging_es_pvc_size=50Gi
----
+
[NOTE]
====
The logging playbook selects a volume based on size and might use an unexpected volume if any other persistent volume has same size.
====

.. Use the following command to rerun the Ansible *_deploy_cluster.yml_* playbook:
+
----
ansible-playbook /usr/share/ansible/openshift-ansible/playbooks/deploy_cluster.yml
----
+
The installer playbook creates the NFS volume based on the `openshift_logging_storage` variables.

*Using a predefined NFS volume*

You can deploy logging alongside the {product-title} cluster using an existing NFS volume.

.Procedure

. Edit the Ansible inventory file to configure the NFS volume and set the PVC size:
+
----
openshift_logging_storage_kind=nfs
openshift_enable_unsupported_configurations=true
openshift_logging_storage_access_modes=["ReadWriteOnce"]
openshift_logging_storage_nfs_directory=/srv/nfs
openshift_logging_storage_nfs_options=*(rw,root_squash)
openshift_logging_storage_volume_name=logging
openshift_logging_storage_volume_size=100Gi
openshift_logging_storage_labels={:storage=>"logging"}
openshift_logging_install_logging=true
----

. Use the following command to redeploy the EFK stack:
+
----
ansible-playbook /usr/share/ansible/openshift-ansible/playbooks/deploy_cluster.yml
----

