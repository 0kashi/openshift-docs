// Module included in the following assemblies:
//
// * logging/efk-logging-elasticsearch.adoc

[id="efk-logging-elasticsearch-status-{context}"]
= Viewing Elasticsearch status

You can view the status of your Elasticsearch cluster.

.Prerequisites

* Cluster logging and Elasticsearch must be installed.

.Procedure

. Change to the `openshift-logging` project.
+
----
$ oc project openshift-logging
----

. To view the Elasticsearch cluster status:

.. Get the name of the Elasticsearch instance:
+
----
$ oc get Elasticsearch

NAME            AGE
elasticsearch   5h9m
----

.. Get the Elasticsearch status:
+
----
$ oc get Elasticsearch <Elasticsearch-instance> -o yaml
----
+
For example:
+
----
$ oc get Elasticsearch elasticsearch -n openshift-logging -o yaml
----
+
The output includes information similar to the following:
+
----
status: <1>
  clusterHealth: green <2>
  conditions: <3>
      .....
  nodes:  <4>
      .....
  pods: <5>
      .....
  shardAllocationEnabled: "True" <6>
----
<1> In the output, the cluster status fields appear in the `status` stanza.
<2> The status of the Elasticsearch cluster, `green`, `red`, `yellow`.
<3> Any status conditions, if present. Any events related to the following conditions are shown:
+
* Container Waiting for both the Elasticsearch and proxy containers,
* Container Terminated for both the Elasticsearch and proxy containers,
* Pod unschedulable.
+
Also, a condition is shown if the node storage passes the high or low watermark thresholds.

<4> The Elasticsearch nodes in the cluster, with `upgradeStatus`.  
<5> The Elasticsearch client, data, and master pods in the cluster, listed under 'failed`, `notReady` or `ready` state.

. To view the status of the Elasticsearch deployment configuration:

.. Get the name of a deployment configuration:
+
----
$ oc get deployment --selector component=elasticsearch -o name

deployment.extensions/elasticsearch-cdm-1gon-1
deployment.extensions/elasticsearch-cdm-1gon-2
deployment.extensions/elasticsearch-cdm-1gon-3
----

.. Get the deployment configuration status:
+
----
$ oc describe deployment elasticsearch-cdm-1gon-1
----
+
The output includes the following status information:
+
----
....
  Containers:
   elasticsearch:
    Image:       quay.io/openshift/origin-logging-elasticsearch5:latest
    Readiness:  exec [/usr/share/elasticsearch/probe/readiness.sh] delay=10s timeout=30s period=5s #success=1 #failure=3

....

Conditions:
  Type           Status   Reason
  ----           ------   ------
  Progressing    Unknown  DeploymentPaused
  Available      True     MinimumReplicasAvailable

....

Events:          <none>
----

. To view the status of the Elasticsearch Replica Set:

.. Get the name of a replica set:
+
----
$ oc get replicaSet --selector component=elasticsearch -o name

replicaset.extensions/elasticsearch-cdm-1gon-1-6f8495
replicaset.extensions/elasticsearch-cdm-1gon-2-5769cf
replicaset.extensions/elasticsearch-cdm-1gon-3-f66f7d
----

.. Get the status of the replica set:
+
----
$ oc describe replicaSet elasticsearch-cdm-1gon-1-6f8495
----
+
The output includes the following status information:
+
----
....
  Containers:
   elasticsearch:
    Image:       quay.io/openshift/origin-logging-elasticsearch5:latest
    Readiness:  exec [/usr/share/elasticsearch/probe/readiness.sh] delay=10s timeout=30s period=5s #success=1 #failure=3

....

Events:          <none>
----

. To view the status of the Elasticsearch pods:

.. Get the name of a pod:
+
----
$ oc get pods --selector component=elasticsearch -o name

pod/elasticsearch-cdm-1godmszn-1-6f8495-vp4lw
pod/elasticsearch-cdm-1godmszn-2-5769cf-9ms2n
pod/elasticsearch-cdm-1godmszn-3-f66f7d-zqkz7
----

.. Get the status of a pod:
+
----
oc describe pod elasticsearch-cdm-1godmszn-1-6f8495-vp4lw
----
+
The output includes the following status information:
+
----
....
Status:             Running

....

Containers:
  elasticsearch:
    Container ID:   cri-o://b7d44e0a9ea486e27f47763f5bb4c39dfd2
    State:          Running
      Started:      Mon, 08 Apr 2019 10:17:56 -0400
    Ready:          True
    Restart Count:  0
    Readiness:  exec [/usr/share/elasticsearch/probe/readiness.sh] delay=10s timeout=30s period=5s #success=1 #failure=3

....

  proxy:
    Container ID:  cri-o://3f77032abaddbb1652c116278652908dc01860320b8a4e741d06894b2f8f9aa1
    State:          Running
      Started:      Mon, 08 Apr 2019 10:18:38 -0400
    Ready:          True
    Restart Count:  0

....

Conditions:
  Type              Status
  Initialized       True 
  Ready             True 
  ContainersReady   True 
  PodScheduled      True 

....

Events:          <none>
----

[id="efk-logging-elasticsearch-status-message{context}"]
== Example condition messages

The following are exemples of some condtion messaages from the `Status.Nodes` section of the Elasticsearch instance.

// https://github.com/openshift/elasticsearch-operator/pull/92

----
  nodes:
  - conditions:
    - lastTransitionTime: 2019-03-15T15:57:22Z
      message: Disk storage usage for node is 27.5gb (36.74%). Shards will be not
        be allocated on this node.
      reason: Disk Watermark Low
      status: "True"
      type: NodeStorage
    deploymentName: example-elasticsearch-clientdatamaster-0-1
    upgradeStatus: {}
----

----
  nodes:
  - conditions:
    - lastTransitionTime: 2019-03-15T16:04:45Z
      message: Disk storage usage for node is 27.5gb (36.74%). Shards will be relocated
        from this node.
      reason: Disk Watermark High
      status: "True"
      type: NodeStorage
    deploymentName: example-elasticsearch-clientdatamaster-0-1
    upgradeStatus: {}
----

