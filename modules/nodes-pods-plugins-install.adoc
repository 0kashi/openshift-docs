// Module included in the following assemblies:
//
// * nodes/nodes-pods-plugins.adoc

[id="nodes-pods-plugins-install-{context}"]
= Enabling Device Manager

Enable Device Manager to implement a device plug-in to advertise specialized
hardware without any upstream code changes.

Device Manager provides a mechanism for advertising specialized node hardware resources
with the help of plug-ins known as device plug-ins.

. Obtain the label associated with the static Machine Config Pool CRD for the type of node you want to configure.
Perform one of the following steps:

.. View the Machine Config Pool:
+
----
$ oc describe machineconfigpool <name>
----
+
For example:
+
[source,yaml]
----
$ oc describe machineconfigpool worker

apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfigPool
metadata:
  creationTimestamp: 2019-02-08T14:52:39Z
  generation: 1
  labels:
    custom-kubelet: small-pods <1>
----
<1> If a label has been added it appears under `labels`.

.. If the label is not present, add a key/value pair:
+
----
$ oc label machineconfigpool worker custom-kubelet=small-pods
----

.Procedure

. Create a Custom Resource (CR) for your configuration change.
+
.Sample configuration for a Device Manager CR
[source,yaml]
----
apiVersion: machineconfiguration.openshift.io/v1
kind: KubeletConfig
metadata:
  name: deploy-device-manager <1>
spec:
  machineConfigPoolSelector:
    matchLabels:
      custom-kubelet: small-pods <2>
  kubeletConfig:
    feature-gates:
      - DevicePlugins=true <2>
----
<1> Assign a name to CR.
<2> Set `DevicePlugins` to 'true`.

. Ensure that Device Manager was actually enabled by confirming that
*_/var/lib/kubelet/device-plugins/kubelet.sock_* is created on the node. This is
the UNIX domain socket on which the Device Manager gRPC server listens for new
plug-in registrations. This sock file is created when the Kubelet is started
only if Device Manager is enabled.
