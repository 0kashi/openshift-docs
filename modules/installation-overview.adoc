// Module included in the following assemblies:
//
// * installation/installing-quickly-cloud.adoc
// * installation/installing-customizations-cloud.adoc
// * installation/installing-existing-hosts.adoc

[id='installation-overview-{context}']
= {product-title} installation overview

You use the {product-title} installer to create {product-title} clusters in
a variety of environments. The same installer allows you to install
{product-title} on your own infrastructure or in Amazon Web Services (AWS).
By default, the installer acts as an installation wizard, prompting you
for values that it cannot determine on its own and providing reasonable default
values for the remaining parameters. You can also customize the installation
process to support advanced infrastructure scenarios.

In supported cloud environments, the installer can also provision the underlying
infrastructure for the cluster. If possible, use this feature to avoid
having to provision and maintain the cluster infrastructure. In all other 
environments, you use the installer to generate the assets that you need to
provision your cluster infrastructure.

[NOTE]
====
In {product-title} version 4.0, the installer can only provision infrastructure
for clusters on AWS. If you use another cloud provider or on-premises hardware, 
you must provide the infrastructure. 
====

[discrete]
== Cluster installation process

In supported cloud environment scenarios, {product-title} manages all aspects of
the cluster, including the operating system itself. Each machine boots with a
configuration that references resources hosted in the cluster that it joins.
This configuration allows the cluster to manage itself as updates are applied.

Because each machine in the cluster requires information about the cluster when
it is provisioned, {product-title} uses a temporary _bootstrap_ machine during
initial configuration. This machine provides the required information. It boots
by using an Ignition
configuration that describes how to create the cluster. This temporary machine
is a temporary control plane that launches the rest of the cluster and then is
destroyed.

The main assets generated by the installer are the Ignition configurations for the
bootstrap, master, and worker machines. With these three configurations and correctly
configured infrastructure, you can start an {product-title} cluster.

Bootstrapping a cluster involves the following steps:

. The bootstrap machine boots and starts hosting the remote resources required
for the master machines to boot.
. The master machines fetch the remote resources from the bootstrap machine
and finish booting.
. The master machines use the bootstrap node to form an etcd cluster.
. The bootstrap node starts a temporary Kubernetes control plane using the
new etcd cluster.
. The temporary control plane schedules the production control plane to the
master machines.
. The temporary control plane shuts down and passes control to the production
control plane.
. The bootstrap node injects {product-title} components into the production
control plane.
. The installer shuts down the bootstrap node.

The result of this bootstrapping process is a fully running {product-title}
cluster. The cluster then downloads and configures remaining components
needed for the day-to-day operation, including the creation of worker machines
in supported environments.

[discrete]
== Key concepts

Although using the default settings is simple and produces a functioning 
{product-title} cluster, you can customize the cluster during installation.
Before you run a customized installation, review the following key concepts.

[discrete]
=== Targets

The {product-title} installer operates on the notion of creating and destroying
targets. Similar to other tools that operate on a graph of dependencies, like
`make` and `systemd`, each target represents a subset of the dependencies in the
graph. The main target in the installer creates a cluster, but the other targets
allow the user to interrupt this process and use or modify the intermediate
artifacts, such as the the Kubernetes manifests that are installed into the
cluster. Only the immediate dependencies of a target are written to disk by the
installer, but you can run the installer multiple times to update more
dependencies.

The installer can create the following targets:

`install-config`::
The installation configuration contains the main parameters
for the installation process. This configuration provides you with more options
than the interactive prompts and comes pre-populated with default values.
`manifests`::
You can generate the Kubernetes manifests that will be installed on the cluster.
`ignition-configs`::
These files contain the Ignition configurations for the bootstrap, master, and
worker machines.
`cluster`::
This target provisions the cluster by invoking a locally-installed 
Terraform.

The following targets can be destroyed by the installer:

`cluster`::
This destroys the created cluster and its associated infrastructure.
`bootstrap`::
This destroys the bootstrap infrastructure.

[discrete]
=== Multiple invocations

Because you must run the installer to generate the assets that you need to
customize your installation, you can run the installer multiple times. The
installation state is stored in a hidden file in the target directory which 
contains all of the intermediate artifacts. Storing the artifacts in this way
lets you pause installation and modify the intermediate artifacts.

For example, if you wanted to create a different number of worker machines, you
must first run the installer with the `install-config` target with the
`openshift-install create install-config` command. After you provide the required
parameters to the interactive installer, it writes the installation
configuration into the target directory. You can then modify the installation
configuration and run the installer with the `cluster` target with the
`openshift-install create cluster` command. The installer reads the install
configuration from disk, removes it from the target directory, and creates a
cluster from the provided configuration.
