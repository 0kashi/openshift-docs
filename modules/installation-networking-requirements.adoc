// Module included in the following assemblies:
//
// * installing-byoh/installing-existing-hosts.adoc

[id='installation-networking-requirements-{context}']
= Networking requirements for BYO installations

The following section defines the requirements of the environment containing
your {product-title} configuration. This includes networking considerations
and access to external services, such as Git repository access, storage, and
cloud infrastructure providers.

[id='prereq-dns-{context}']
== DNS Requirements

{product-title} requires a fully functional DNS server in the environment. This
is ideally a separate host running DNS software and can provide name resolution
to hosts and containers running on the platform.

[IMPORTANT]
Adding entries into the *_/etc/hosts_* file on each host is not enough. This
file is not copied into containers running on the platform.

Key components of {product-title} run themselves inside of containers and use
the following process for name resolution:

. By default, containers receive their DNS configuration
file (*_/etc/resolv.conf_*) from their host.

. {product-title} then sets the pod's first nameserver to the IP address of
the node.

`dnsmasq` is automatically configured on all masters and nodes. The pods use the
nodes as their DNS, and the nodes forward the requests. By default, `dnsmasq`
is configured on the nodes to listen on port 53, therefore the nodes cannot run
any other type of DNS application.

[NOTE]
====
If the `PEERDNS` parameter is set to `no` in the network script, for
example, *_/etc/sysconfig/network-scripts/ifcfg-em1_*, then the dnsmasq files
are not generated, and the Ansible install will fail. Ensure the `PEERDNS`
setting is set to `yes`.
====

The following is an example set of DNS records:

----
master1    A   10.64.33.100
master2    A   10.64.33.103
node1      A   10.64.33.101
node2      A   10.64.33.102
----

If you do not have a properly functioning DNS environment, you might experience
failure with:

- Product installation via the reference Ansible-based scripts
- Deployment of the infrastructure containers (registry, routers)
- Access to the {product-title} web console, because it is not accessible via
IP address alone


[id='prereq-network-access-{context}']
== Network access requirements

A shared network must exist between the master and node hosts. If you plan to
configure multiple masters for high-availability using standard cluster installation
process, you must also select an IP to be configured as your virtual IP (VIP)
during the installation process. The IP that you select must be routable
between all of your nodes, and if you configure using a FQDN it must resolve
on all nodes.

[id='prereq-networkmanager-{context}']
=== NetworkManager

`NetworkManager`, a program for providing detection and configuration for
systems to automatically connect to the network, is required on the nodes in
order to populate `dnsmasq` with the DNS IP addresses.

`NM_CONTROLLED` is set to `yes` by default. If `NM_CONTROLLED` is set to `no`,
then the NetworkManager dispatch script does not create the relevant
*_origin-upstream-dns.conf_* dnsmasq file, and you must configure
dnsmasq manually.

[id='install-config-network-using-firewalld-{context}']
=== Firewall requirements

While iptables is the default firewall, firewalld is recommended for new
installations. You can enable firewalld by setting
`os_firewall_use_firewalld=true` in the Ansible inventory file.

----
[OSEv3:vars]
os_firewall_use_firewalld=True
----

Setting this variable to `true` opens the required ports and adds rules to the
default zone, which ensure that firewalld is configured correctly.

[NOTE]
====
Using the firewalld default configuration comes with limited configuration
options, and cannot be overridden. For example, while you can set up a storage
network with interfaces in multiple zones, the interface that nodes communicate
on must be in the default zone.
====
