// Module included in the following assemblies:
//
// * logging/efk-logging-deploy.adoc

[id='efk-logging-fluentd-rate-limiting_{context}']
= Rate-limiting systemd-journald and rsyslog

In Red Hat Enterprise Linux (RHEL) 7 the *systemd-journald.socket* unit creates
*_/dev/log_* during the boot process, and then passes input to
*systemd-journald.service*. Every *syslog()* call goes to the journal.

Rsyslog uses the *imjournal* module as a default input mode for journal files.
Refer to
link:https://access.redhat.com/documentation/en-US/Red_Hat_Enterprise_Linux/7/html-single/System_Administrators_Guide/index.html#s1-interaction_of_rsyslog_and_journal[Interaction
of rsyslog and journal] for detailed information about this topic.

A simple test harness was developed, which uses
link:http://linux.die.net/man/1/logger[logger] across the cluster nodes to make
entries of different sizes at different rates in the system log. During testing
simulations under a default Red Hat Enterprise Linux (RHEL) 7 installation with
`systemd-219-19.el7.x86_64` at certain logging rates (approximately 40 log lines
per second), we encountered the default rate limit of `rsyslogd`. After
adjusting these limits, entries stopped being written to journald due to local
journal file corruption.
link:https://rhn.redhat.com/errata/RHBA-2016-1026.html[This issue is resolved in
later versions of systemd].

