// Module included in the following assemblies:
//
// * logging/efk-logging-elasticsearch.adoc

[id='efk-logging-elasticsearch-persistent-storage-persistent-dynamic_{context}']
= Configuring Elasticscearch storage to use dynamic NFS persistent volume

You can deploy NFS as an automatically provisioned persistent volume.

For more information, see _Sharing an NFS mount across two persistent volume claims_ to leverage shared storage for use by two separate containers.

.Procedure

. Prepare persistent volumes
+
----
oc get pv
oc label volume $volumename 'preparefor'="logging1"
----

. Edit or create the Cluster Logging Custom Resource (CR): 
+
[source,yaml]
----
spec:
  managementState: Managed
  nodeSpec:
    image: brewregistry.stage.redhat.io/openshift/ose-logging-elasticsearch5:v4.0
    resources: {}
  nodes:
  - nodeCount: 2
    nodeSpec:
      resources: {}
    roles:
    - client
    - data
    - master
    storage:
      size: 10Gi
      storageClassName: gp2
----

. Check that the PVC was created:
+
[source,bash]
----
$ oc get pvc -n openshift-logging

NAME                                               STATUS    VOLUME                           CAPACITY   ACCESS MODES   STORAGECLASS   AGE
elasticsearch-elasticsearch-clientdatamaster-0-1   Bound     pvc-23e6e214-2068-8459-06d947a   10Gi       RWO            gp2            1m
elasticsearch-elasticsearch-clientdatamaster-0-2   Bound     pvc-24608a9b-2068-8459-06d947a   10Gi       RWO            gp2            1m
----

. Check that the PVC is mounted to Elasticsearch:
+
[source,bash]
----
$ oc get deployment --select component=elasticsearch
----

